# EXAIM Evaluation - Multi-Agent System Generation Configuration
# This file defines parameters for MAS trace generation using MAC
#
# Timed Trace Generation - Raw Stream Capture
# - Traces store delta_text + timestamps only
# - No derived units (ws_units, ctu) in traces
# - Derived units computed during replay/evaluation

# =============================================================================
# MAS Generation Mode
# =============================================================================
mode: "mac_integration"

# =============================================================================
# MAC Integration Configuration
# =============================================================================
mac:
  enabled: true
  
  # Path to MAC module (inside Docker container)
  module_path: "/app/third_party/mac"
  
  # MAC fork repository URL
  fork_url: "https://github.com/AbemKW/mac-streaming-traces"
  
  # Pinned commit hash of the MAC submodule used for trace generation.
  # This duplicates the git submodule pin for explicit provenance
  # in evaluation artifacts and metadata logs.
  # Repository: https://github.com/AbemKW/mac-streaming-traces
  # Fork of original MAC repo with delta/chunk-level streaming instrumentation
  commit: "1d5b227afa64fe3dd5eb7b7c0ef778a09501b220"
  
  # Base model used by MAC for agent conversations
  base_model: "gpt-4o-mini"
  
  # Decoding parameters - CANONICALIZED for mas_run_id hash
  # These parameters contribute to the deterministic ID generation
  decoding:
    temperature: 1.0
    top_p: null           # null = not set (use provider default)
    max_tokens: 4096
    seed: null            # null = non-deterministic generation
    # NOTE: Actual decoding is controlled by MAC internally
    # These values are logged for provenance only

# =============================================================================
# Run ID Generation (Input-Derived, Deterministic)
# =============================================================================
# IDs are derived from inputs only (no date) for true determinism.
# Same inputs = same ID regardless of when generation runs.

mas_run_id:
  # Format: mas_<mac8>_<model>_<decoding8>_<cases8>
  # - mac8: first 8 chars of MAC commit hash
  # - model: slugified model name (lowercase, no dashes/dots)
  # - decoding8: first 8 chars of SHA256(canonicalized decoding params)
  # - cases8: first 8 chars of case_list_hash
  policy: "input_derived"
  example: "mas_1d5b227a_gpt4omini_a3b4c5d6_e7f8g9h0"

dataset_id:
  # Format: exaid_traces_<mac8>_<decoding8>_<cases8>
  policy: "input_derived"
  example: "exaid_traces_1d5b227a_a3b4c5d6_e7f8g9h0"

# Placeholder for future evaluation runs
eval_run_id:
  # Format: eval-<trace_dataset_hash_8>-<exaid_commit_8>
  # - trace_dataset_hash_8: first 8 chars of trace_dataset_hash (from manifest)
  # - exaid_commit_8: first 8 chars of EXAIM commit hash (legacy field name for artifact compatibility)
  policy: "input_derived"
  note: "Batch-level identifier shared across all variants. Deterministic: same inputs produce same ID."
  example: "eval-b2c3d4e5-8d45cbb1"

# =============================================================================
# Raw Stream Capture (No Derived Units)
# =============================================================================
# Traces are RAW stream captures.
# Derived units are NOT stored; they are computed during replay.

raw_capture:
  # What is stored in traces:
  stored:
    - delta_text      # Raw delta/chunk from LLM
    - t_emitted_ms    # Absolute emission timestamp
    - t_rel_ms        # Relative to t0_emitted_ms
    - agent_id        # Agent attribution
    - turn_id         # Turn structure
    - seq             # Global sequence number
  
  # What is NOT stored (computed during replay):
  not_stored:
    - ws_units        # Computed by TokenGate during replay
    - ctu             # Computed during metrics evaluation
  
  # Rationale: Under streaming fragmentation, per-delta whitespace counting
  # produces unreliable results. TokenGate-size counting must use the same
  # streaming accumulator logic during replay. Storing derived units
  # increases drift risk between capture and replay.

# =============================================================================
# Output Configuration
# =============================================================================
output:
  # Output directory (relative to evals/)
  traces_dir: "data/traces"
  manifests_dir: "data/manifests"
  
  # Output file format
  format: "jsonl.gz"
  
  # Compression level (1-9)
  compression_level: 6

# =============================================================================
# Documentation Tracking
# =============================================================================
# Used to track when documentation was last updated for this integration

documentation:
  # EXAIM commit hash when this configuration was last updated
  last_updated_commit: "pending"
  # Date when schema/config was last reviewed for paper submission
  # NOTE: This is the review date, not the run date. Update when config changes.
  config_reviewed_date: "2025-12-24"
  # Schema version this config is compatible with
  trace_schema_version: "2.0.0"
  manifest_schema_version: "2.0.0"
